// Generated by CoffeeScript 1.3.3
(function() {
  var GridCell, GridColumn, GridRow, ResetBtn;

  window.unpack = function(obj) {
    var key, report, value;
    if (!(obj != null)) {
      return "undefined";
    }
    report = new Array();
    for (key in obj) {
      value = obj[key];
      if (value instanceof Function) {
        report.push(key + ":" + unpack(value));
      } else {
        if (key !== void 0) {
          report.push(key + ":" + value);
        }
      }
    }
    return report.join("\t");
  };

  window.Grid = (function() {

    Grid.anim_duration = 250;

    Grid.anim_cmd = {
      duration: Grid.anim_duration,
      queue: false
    };

    function Grid(table) {
      var all_columns_width, all_rows_height,
        _this = this;
      this.table = table;
      this.columns = $("th.col", this.table);
      this.rows = $("td.row", this.table);
      this.cells = $("td.cell", this.table);
      this.reset_btn = $("th#x", this.table);
      this.cell_color = "#222222";
      this.selected_row_color = "#873220";
      this.selected_column_color = "#9a1000";
      this.selected_cell_color = "#cc877f";
      if (this.cells.length !== (this.columns.length * this.rows.length)) {
        alert("Warning: " + this.cells.length + " cells for " + this.columns.length + " columns and " + this.rows.length + " rows.");
        return;
      }
      this.columns.each(function(index, column) {
        return new GridColumn(column, _this);
      });
      this.rows.each(function(index, row) {
        return new GridRow(row, _this);
      });
      this.cells.each(function(index, cell) {
        return new GridCell(cell, _this);
      });
      this.reset_btn.each(function(index, btn) {
        return new ResetBtn(btn, _this);
      });
      all_columns_width = this.columns.width() * this.columns.length;
      this.normal_column_width = all_columns_width / (1.0 * this.columns.length);
      this.contracted_column_width = all_columns_width / (1.0 * (this.columns.length + 1));
      this.columns.animate({
        width: this.normal_column_width
      }, 20);
      all_rows_height = this.rows.height() * this.rows.length;
      this.normal_row_height = all_rows_height / (1.0 * this.rows.length);
      this.contracted_row_height = all_rows_height / (1.0 * (this.rows.length + 1));
      this.rows.animate({
        height: this.normal_row_height
      }, 20);
    }

    Grid.prototype.expand_column = function(column_element, grid_column) {
      this.columns.not(column_element).animate({
        width: this.contracted_column_width
      }, Grid.anim_cmd);
      $(column_element).animate({
        width: 2 * this.contracted_column_width
      }, Grid.anim_cmd);
      this.rows.nextAll().andSelf().animate({
        height: this.normal_row_height
      }, Grid.anim_cmd);
      this.rows.nextAll().animate({
        backgroundColor: this.cell_color
      }, Grid.anim_cmd);
      return grid_column.get_cells().animate({
        backgroundColor: this.selected_column_color
      }, Grid.anim_cmd);
    };

    Grid.prototype.expand_row = function(row_element, grid_row) {
      this.rows.nextAll().andSelf().not(row_element).animate({
        height: this.contracted_row_height
      }, Grid.anim_cmd);
      $(row_element).nextAll().andSelf().animate({
        height: 2 * this.contracted_row_height
      }, Grid.anim_cmd);
      this.columns.animate({
        width: this.normal_column_width
      }, Grid.anim_cmd);
      this.rows.nextAll().animate({
        backgroundColor: this.cell_color
      }, Grid.anim_cmd);
      return $(row_element).nextAll().animate({
        backgroundColor: this.selected_row_color
      }, Grid.anim_cmd);
    };

    Grid.prototype.expand_cell = function(cell_element) {
      var cell_column_element, cell_row_element, column_nbr, row_nbr;
      column_nbr = $(cell_element).data("column-nbr");
      row_nbr = $(cell_element).data("row-nbr");
      cell_column_element = this.columns.get(column_nbr - 1);
      cell_row_element = this.rows.get(row_nbr - 1);
      this.columns.not(cell_column_element).animate({
        width: this.contracted_column_width
      }, Grid.anim_cmd);
      $(cell_column_element).animate({
        width: 2 * this.contracted_column_width
      }, Grid.anim_cmd);
      this.rows.nextAll().andSelf().not(cell_row_element).animate({
        height: this.contracted_row_height
      }, Grid.anim_cmd);
      $(cell_row_element).nextAll().andSelf().animate({
        height: 2 * this.contracted_row_height
      }, Grid.anim_cmd);
      this.rows.nextAll().animate({
        backgroundColor: this.cell_color
      }, Grid.anim_cmd);
      $(cell_row_element).nextAll().animate({
        backgroundColor: this.selected_row_color
      }, Grid.anim_cmd);
      $(".cell[data-column-nbr=" + $(cell_column_element).data("ordinal") + "]").animate({
        backgroundColor: this.selected_column_color
      }, Grid.anim_cmd);
      return $(cell_element).animate({
        backgroundColor: "white"
      }, Grid.anim_cmd);
    };

    Grid.prototype.reset = function() {
      this.columns.animate({
        width: this.normal_column_width
      }, Grid.anim_cmd);
      this.rows.nextAll().andSelf().animate({
        height: this.normal_row_height
      }, Grid.anim_cmd);
      this.rows.nextAll().animate({
        backgroundColor: this.cell_color
      }, Grid.anim_cmd);
      return this.columns.each(function(index, element) {
        return $(".cell[data-column-nbr=" + $(element).data("ordinal") + "]").animate({
          backgroundColor: this.cell_color
        }, Grid.anim_cmd);
      });
    };

    return Grid;

  })();

  GridColumn = (function() {

    function GridColumn(element, grid) {
      var _this = this;
      this.element = element;
      this.grid = grid;
      $(this.element).click(function(e) {
        return _this.grid.expand_column(_this.element, _this);
      });
    }

    GridColumn.prototype.get_cells = function() {
      return $(".cell[data-column-nbr=" + $(this.element).data("ordinal") + "]");
    };

    return GridColumn;

  })();

  GridRow = (function() {

    function GridRow(element, grid) {
      var _this = this;
      this.element = element;
      this.grid = grid;
      $(this.element).click(function(e) {
        return _this.grid.expand_row(_this.element, _this);
      });
    }

    return GridRow;

  })();

  GridCell = (function() {

    function GridCell(element, grid) {
      var _this = this;
      this.element = element;
      this.grid = grid;
      $(this.element).click(function(e) {
        return _this.grid.expand_cell(_this.element);
      });
    }

    return GridCell;

  })();

  ResetBtn = (function() {

    function ResetBtn(element, grid) {
      var _this = this;
      this.element = element;
      this.grid = grid;
      $(this.element).click(function(e) {
        return _this.grid.reset();
      });
    }

    return ResetBtn;

  })();

  $(function() {
    var grid;
    return grid = new Grid($("table#grid"));
  });

}).call(this);
